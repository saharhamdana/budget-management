<!-- Main content (scrollable) -->
<div class="content-area flex-grow-1 overflow-auto p-4">
  
  <!-- Upload Section -->
  <div class="card custom-card mb-4 shadow-sm">
    <div class="card-body">
      <h5 class="section-title mb-3">üì§ Upload Excel File</h5>
      <div class="input-group">
        <input type="file" class="form-control" id="inputGroupFile02" (change)="handleFileInput($event)" accept=".xlsx, .xls" />
        <label class="input-group-text btn btn-accent text-white" for="inputGroupFile02">Upload</label>
      </div>
    </div>
  </div>

  <!-- Filter Section -->
  <div class="card custom-card mb-4 shadow-sm">
    <div class="card-body">
      <h5 class="section-title mb-3">üîç Filters</h5>
      <div class="row g-3">
        <div class="col-md-4">
          <input type="text" class="form-control" placeholder="Filter by name" [(ngModel)]="filterName" (ngModelChange)="filterTransactions()" />
        </div>
        <div class="col-md-4">
          <input type="text" class="form-control" placeholder="Global filter..." [(ngModel)]="globalFilter" (ngModelChange)="filterTransactions()" />
        </div>
      </div>
    </div>
  </div>

  <!-- Transactions Table (Only shows transactions without categories) -->
  <div *ngIf="filteredTransactions.length > 0; else noData" class="card custom-card shadow-sm">
    <div class="card-body">
      <h5 class="section-title mb-3">üìä Transactions </h5>
      <div class="table-responsive">
  <table class="table table-striped table-hover">
    <thead class="table-primary">
      <tr>
        <th *ngFor="let key of getDisplayKeys(filteredTransactions[0])">
          {{ key }}
        </th>
        <!-- On supprime la colonne Action -->
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let row of filteredTransactions">
        <td *ngFor="let key of getDisplayKeys(row)">
          <!-- V√©rifie si c‚Äôest la colonne categorie -->
          <ng-container *ngIf="key === 'categorie'; else normalCell">
            <button class="btn btn-sm btn-outline-primary"
                    (click)="affecterCategorie(row)">
              Assign Category
            </button>
          </ng-container>
          <ng-template #normalCell>
            {{ row[key] }}
          </ng-template>
        </td>
      </tr>
    </tbody>
  </table>
</div>

    </div>
  </div>

  <!-- No Data Template -->
  <ng-template #noData>
    <div class="alert alert-info text-center">No transactions without categories.</div>
  </ng-template>
</div>

<!-- MODAL FOR CATEGORY ASSIGNMENT -->
<div class="modal fade" id="categorieModal" tabindex="-1" aria-labelledby="categorieModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <div class="modal-content modal-custom">
      
      <!-- HEADER -->
      <div class="modal-header" style="background-color: var(--primary-color); color: white;">
        <h5 class="modal-title" id="categorieModalLabel">Assign a Category</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- BODY -->
      <div class="modal-body">
        <div class="row g-2">
          <div class="col-4" *ngFor="let cat of categories">
            <div class="category-card text-center p-2 rounded shadow-sm"
                 [class.selected]="selectedCategorieId === cat.id"
                 (click)="selectedCategorieId = cat.id"
                 style="cursor: pointer;">
              <i [ngClass]="getCategoryIcon(cat.nomAng)" class="category-icon"></i>
              <div class="mt-1">{{ cat.nomAng }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- FOOTER -->
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary confirm-btn" (click)="confirmerAffectation()">Confirm</button>
      </div>

    </div>
  </div>
</div>